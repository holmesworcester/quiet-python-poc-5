{
  "description": "Tests for the /__framework/events API endpoint",
  "schema": {
    "$schema": "http://json-schema.org/draft-07/schema#",
    "type": "object",
    "required": ["type"],
    "properties": {
      "type": {
        "type": "string"
      }
    }
  },
  "commands": {
    "create_test_event": {
      "description": "Create a test event to verify it appears in the events API"
    },
    "verify_events": {
      "description": "Query the events API and verify events are returned correctly"
    }
  },
  "tests": [
    {
      "name": "events_api_returns_events_with_correct_envelope",
      "description": "Verify that the /__framework/events endpoint returns events with the correct envelope format (payload/metadata)",
      "given": [],
      "when": [
        {
          "command": "create_test_event",
          "parameters": {
            "event_type": "test_event",
            "event_data": {
              "message": "Hello from test",
              "timestamp": 1234567890
            }
          }
        }
      ],
      "then": {
        "events": [
          {
            "type": "test_event",
            "message": "Hello from test",
            "timestamp": 1234567890
          }
        ]
      }
    },
    {
      "name": "events_api_envelope_format",
      "description": "Verify the exact envelope format returned by the events API",
      "given": [
        {
          "type": "existing_event",
          "data": "test data 1"
        },
        {
          "type": "existing_event", 
          "data": "test data 2"
        }
      ],
      "when": [
        {
          "command": "verify_events",
          "parameters": {}
        }
      ],
      "then": {
        "events": [
          {
            "type": "events_api_verification",
            "event_count": 2,
            "has_payload_field": true,
            "has_metadata_field": true,
            "first_event_type": "existing_event"
          }
        ]
      }
    }
  ]
}