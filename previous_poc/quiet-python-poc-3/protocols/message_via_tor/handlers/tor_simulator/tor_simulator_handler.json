{
  "type": "tor_simulator",
  "commands": {
    "deliver": {
      "description": "Converts all outgoing events to recipient peer to incoming events for that recipient",
      "func": "deliver.execute",
      "tests": [
        {
          "given": {
            "db": {
              "outgoing": [
                {
                  "recipient": "peer1",
                  "data": {
                    "type": "message",
                    "text": "Hello",
                    "sender": "peer2"
                  },
                  "created_at": 0,
                  "sent": false
                },
                {
                  "recipient": "peer2",
                  "data": {
                    "type": "sync_peers",
                    "sender": "peer1"
                  },
                  "created_at": 0,
                  "sent": false
                }
              ]
            },
            "params": {}
          },
          "then": {
            "return": {
              "return": "Delivered 2 messages"
            },
            "snapshot": {
              "outgoing": [],
              "incoming": [
                {
                  "recipient": "peer1",
                  "data": {
                    "type": "message",
                    "text": "Hello",
                    "sender": "peer2"
                  },
                  "metadata": {
                    "origin": "network",
                    "receivedAt": "*",
                    "selfGenerated": false,
                    "received_by": "peer1"
                  }
                },
                {
                  "recipient": "peer2",
                  "data": {
                    "type": "sync_peers",
                    "sender": "peer1"
                  },
                  "metadata": {
                    "origin": "network",
                    "receivedAt": "*",
                    "selfGenerated": false,
                    "received_by": "peer2"
                  }
                }
              ]
            }
          }
        }
      ]
    }
  },
  "job": "deliver"
}