{
  "type": "unknown",
  "projector": {
    "description": "Projects decrypted but unrecognized event types to state.unknown_events",
    "func": "projector.project",
    "tests": [
      {
        "given": {
          "db": {},
          "envelope": {
            "metadata": {
              "eventId": "event123",
              "origin": "peer1",
              "receivedAt": 1000
            },
            "payload": {
              "type": "unrecognized_type",
              "data": "some data"
            }
          }
        },
        "then": {
          "snapshot": {
            "unknown_events": [
              {
                "data": {
                  "type": "unrecognized_type",
                  "data": "some data"
                },
                "metadata": {
                  "eventId": "event123",
                  "origin": "peer1",
                  "receivedAt": 1000
                },
                "timestamp": 1000
              }
            ]
          }
        }
      },
      {
        "given": {
          "db": {
            "unknown_events": [
              {
                "data": {
                  "type": "old_type"
                },
                "metadata": {},
                "timestamp": 500
              }
            ]
          },
          "envelope": {
            "metadata": {
              "eventId": "event456",
              "receivedAt": 2000
            },
            "payload": {
              "type": "another_unknown",
              "value": 42
            }
          }
        },
        "then": {
          "snapshot": {
            "unknown_events": [
              {
                "data": {
                  "type": "old_type"
                },
                "timestamp": 500
              },
              {
                "data": {
                  "type": "another_unknown",
                  "value": 42
                },
                "metadata": {
                  "eventId": "event456",
                  "receivedAt": 2000
                },
                "timestamp": 2000
              }
            ]
          }
        }
      }
    ]
  },
  "commands": {
    "purge_old": {
      "description": "Purge old unknown events to prevent unbounded growth",
      "func": "purge_old.execute",
      "tests": [
        {
          "given": {
            "db": {
              "unknown_events": [
                {
                  "data": {
                    "type": "old_event"
                  },
                  "metadata": {},
                  "timestamp": 1000
                },
                {
                  "data": {
                    "type": "recent_event"
                  },
                  "metadata": {},
                  "timestamp": 90000000
                }
              ]
            },
            "params": {
              "current_time_ms": 100000000,
              "cutoff_hours": 24
            }
          },
          "then": {
            "return": {
              "return": "Purged 1 events",
              "purged": 1,
              "remaining": 1
            }
          }
        },
        {
          "given": {
            "db": {},
            "params": {
              "current_time_ms": 100000000
            }
          },
          "then": {
            "return": {
              "return": "No unknown events",
              "purged": 0
            }
          }
        }
      ]
    }
  },
  "job": "purge_old"
}
