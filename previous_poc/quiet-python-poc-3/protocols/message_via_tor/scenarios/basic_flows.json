{
  "scenarios": {
    "basic_identity_management": {
      "description": "Create and list identities",
      "steps": [
        {
          "name": "create_first_identity",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "Alice"
            }
          },
          "assertions": {
            "status": 201,
            "body.identityId": "*",
            "body.publicKey": "*",
            "capture": {
              "alice_id": "$.identityId"
            }
          }
        },
        {
          "name": "create_second_identity",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "Bob"
            }
          },
          "assertions": {
            "status": 201,
            "body.identityId": "*",
            "body.publicKey": "*"
          }
        },
        {
          "name": "list_all_identities",
          "request": {
            "method": "GET",
            "path": "/identities"
          },
          "assertions": {
            "status": 200,
            "body.identities": {
              "$length": 2
            }
          }
        }
      ]
    },

    "invite_link_flow": {
      "description": "Create invite link and join network",
      "steps": [
        {
          "name": "create_inviter",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "Inviter"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "inviter_id": "$.identityId"
            }
          }
        },
        {
          "name": "generate_invite_link",
          "request": {
            "method": "POST",
            "path": "/identities/${inviter_id}/invite"
          },
          "assertions": {
            "status": 200,
            "body.inviteLink": "*",
            "capture": {
              "invite": "$.inviteLink"
            }
          }
        },
        {
          "name": "join_with_invite",
          "request": {
            "method": "POST",
            "path": "/join",
            "body": {
              "inviteLink": "${invite}",
              "name": "NewMember"
            }
          },
          "assertions": {
            "status": 201,
            "body.identityId": "*",
            "body.publicKey": "*"
          }
        },
        {
          "name": "verify_identities_exist",
          "request": {
            "method": "GET",
            "path": "/identities"
          },
          "assertions": {
            "status": 200,
            "body.identities": {
              "$length": 2
            }
          }
        }
      ]
    },

    "peer_creation": {
      "description": "Create peers and verify they are stored",
      "steps": [
        {
          "name": "create_test_identity",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "TestUser"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "user_id": "$.identityId"
            }
          }
        },
        {
          "name": "add_first_peer",
          "request": {
            "method": "POST",
            "path": "/peers",
            "body": {
              "publicKey": "peer_pubkey_123",
              "name": "Peer One"
            }
          },
          "assertions": {
            "status": 201,
            "body.peer.pubkey": "peer_pubkey_123",
            "body.peer.name": "Peer One"
          }
        },
        {
          "name": "add_second_peer",
          "request": {
            "method": "POST",
            "path": "/peers",
            "body": {
              "publicKey": "peer_pubkey_456",
              "name": "Peer Two"
            }
          },
          "assertions": {
            "status": 201,
            "body.peer.pubkey": "peer_pubkey_456"
          }
        }
      ]
    },

    "message_creation": {
      "description": "Create messages and verify message list",
      "steps": [
        {
          "name": "create_sender",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "Sender"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "sender_id": "$.identityId"
            }
          }
        },
        {
          "name": "send_message",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "text": "Test message content",
              "senderId": "${sender_id}"
            }
          },
          "assertions": {
            "status": 201,
            "body.sentTo": 0
          }
        },
        {
          "name": "check_own_messages",
          "request": {
            "method": "GET",
            "path": "/messages/${sender_id}"
          },
          "assertions": {
            "status": 200,
            "body.messages": {
              "$length": 1
            },
            "body.messages[0].text": "Test message content",
            "body.messages[0].sender": "${sender_id}"
          }
        }
      ]
    },

    "tick_processing": {
      "description": "Verify tick endpoint processes jobs",
      "steps": [
        {
          "name": "run_first_tick",
          "request": {
            "method": "POST",
            "path": "/tick",
            "body": {
              "time_now_ms": 1000
            }
          },
          "assertions": {
            "status": 200,
            "body.message": "Tick completed"
          }
        },
        {
          "name": "run_second_tick",
          "request": {
            "method": "POST",
            "path": "/tick",
            "body": {
              "time_now_ms": 2000
            }
          },
          "assertions": {
            "status": 200
          }
        }
      ]
    }
  }
}