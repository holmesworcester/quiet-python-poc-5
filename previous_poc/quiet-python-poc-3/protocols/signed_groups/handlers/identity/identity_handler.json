{
  "type": "identity",
  "projector": {
    "description": "Projects identity events for signed groups protocol",
    "func": "projector.project",
    "tests": [
      {
        "description": "Projects identity with dummy crypto",
        "given": {
          "env": {
            "CRYPTO_MODE": "dummy"
          },
          "db": {},
          "envelope": {
            "metadata": {},
            "payload": {
              "type": "identity",
              "pubkey": "test_pubkey_123",
              "privkey": "test_privkey_123",
              "name": "Alice"
            }
          }
        },
        "then": {
          "db": {
            "identities": [
              {
                "pubkey": "test_pubkey_123",
                "privkey": "test_privkey_123",
                "name": "Alice"
              }
            ]
          }
        }
      },
      {
        "description": "Projects identity with any crypto values",
        "given": {
          "db": {},
          "envelope": {
            "metadata": {},
            "payload": {
              "type": "identity",
              "pubkey": "*",
              "privkey": "*",
              "name": "Alice"
            }
          }
        },
        "then": {
          "db": {
            "identities": [
              {
                "pubkey": "*",
                "privkey": "*",
                "name": "Alice"
              }
            ]
          }
        }
      }
    ]
  },
  "commands": {
    "create": {
      "description": "Creates an identity keypair",
      "func": "create.execute",
      "tests": [
        {
          "given": {
            "db": {},
            "params": {
              "name": "Bob"
            }
          },
          "then": {
            "return": {
              "api_response": {
                "identityId": "*",
                "publicKey": "*",
                "name": "Bob"
              },
              "newEvents": [
                {
                  "type": "identity",
                  "pubkey": "*",
                  "privkey": "*",
                  "name": "Bob"
                }
              ]
            }
          }
        }
      ]
    },
    "list": {
      "description": "List identities",
      "func": "list.execute",
      "tests": [
        {
          "description": "List all identities",
          "given": {
            "db": {
              "identities": [
                {
                  "pubkey": "pubkey1",
                  "privkey": "privkey1",
                  "name": "Alice"
                },
                {
                  "pubkey": "pubkey2",
                  "privkey": "privkey2",
                  "name": "Bob"
                }
              ]
            },
            "params": {}
          },
          "then": {
            "return": {
              "api_response": {
                "identities": [
                  {
                    "pubkey": "pubkey1",
                    "name": "Alice"
                  },
                  {
                    "pubkey": "pubkey2",
                    "name": "Bob"
                  }
                ]
              }
            }
          }
        },
        {
          "description": "Empty list when no identities",
          "given": {
            "db": {},
            "params": {}
          },
          "then": {
            "return": {
              "api_response": {
                "identities": []
              }
            }
          }
        }
      ]
    }
  }
}
