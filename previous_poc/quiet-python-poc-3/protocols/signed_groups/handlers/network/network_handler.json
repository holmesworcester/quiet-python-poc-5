{
  "type": "network",
  "projector": {
    "description": "Projects network creation events",
    "func": "projector.project",
    "tests": [
      {
        "given": {
          "db": {},
          "envelope": {
            "metadata": {},
            "payload": {
              "type": "network",
              "id": "network_id_123",
              "name": "Test Network",
              "creator_pubkey": "test_pubkey_123"
            }
          },
          "env": {
            "CRYPTO_MODE": "dummy"
          }
        },
        "then": {
          "db": {
            "networks": [
              {
                "id": "network_id_123",
                "name": "Test Network",
                "creator_pubkey": "test_pubkey_123"
              }
            ]
          }
        }
      }
    ]
  },
  "commands": {
    "create": {
      "description": "Creates a new network",
      "func": "create.execute",
      "tests": [
        {
          "given": {
            "db": {
              "identities": [
                {
                  "pubkey": "creator_pub",
                  "privkey": "creator_priv",
                  "name": "Creator"
                }
              ]
            },
            "params": {
              "name": "My Network",
              "identityId": "creator_pub"
            },
            "env": {
              "CRYPTO_MODE": "dummy"
            }
          },
          "then": {
            "return": {
              "api_response": {
                "networkId": "*",
                "name": "My Network",
                "firstGroupId": "*",
                "defaultChannelId": "*"
              },
              "newEvents": [
                {
                  "type": "network",
                  "id": "*",
                  "name": "My Network",
                  "creator_pubkey": "creator_pub"
                },
                {
                  "type": "user",
                  "id": "*",
                  "network_id": "*",
                  "pubkey": "creator_pub",
                  "name": "Creator",
                  "group_id": "*",
                  "signature": "dummy_sig_dXNlcjoqOio6Q3JlYXRvcjpjcmVhdG9yX3B1Yg==_by_creator_pub"
                },
                {
                  "type": "group",
                  "id": "*",
                  "name": "General",
                  "created_by": "*",
                  "signature": "dummy_sig_Z3JvdXA6KjpHZW5lcmFsOio=_by_*_pub"
                },
                {
                  "type": "add",
                  "id": "*",
                  "user_id": "*",
                  "group_id": "*",
                  "added_by": "*",
                  "signature": "dummy_sig_YWRkOio6KjoqOio=_by_*_pub"
                },
                {
                  "type": "channel",
                  "id": "*",
                  "network_id": "*",
                  "group_id": "*",
                  "name": "general",
                  "created_by": "*",
                  "signature": "dummy_sig_Y2hhbm5lbDoqOio6Z2VuZXJhbDoq_by_*_pub"
                }
              ]
            }
          }
        }
      ]
    },
    "list": {
      "description": "List networks",
      "func": "list.execute",
      "tests": [
        {
          "description": "List all networks",
          "given": {
            "db": {
              "networks": [
                {
                  "id": "net1",
                  "name": "Network 1",
                  "creator_pubkey": "pub1",
                  "created_at_ms": 1000
                },
                {
                  "id": "net2",
                  "name": "Network 2",
                  "creator_pubkey": "pub2",
                  "created_at_ms": 2000
                }
              ]
            },
            "params": {}
          },
          "then": {
            "return": {
              "api_response": {
                "networks": [
                  {
                    "id": "net1",
                    "name": "Network 1",
                    "created_at_ms": 1000
                  },
                  {
                    "id": "net2",
                    "name": "Network 2",
                    "created_at_ms": 2000
                  }
                ]
              }
            }
          }
        },
        {
          "description": "Empty list when no networks",
          "given": {
            "db": {},
            "params": {}
          },
          "then": {
            "return": {
              "api_response": {
                "networks": []
              }
            }
          }
        }
      ]
    }
  }
}
