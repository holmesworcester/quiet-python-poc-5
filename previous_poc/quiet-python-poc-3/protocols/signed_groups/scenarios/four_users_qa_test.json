{
  "scenarios": {
    "four_users_basic_flow": {
      "description": "Four users create identities, join a network, and exchange messages",
      "steps": [
        {
          "name": "create_alice",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "alice"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "alice_id": "$.identityId"
            }
          }
        },
        {
          "name": "create_bob",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "bob"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "bob_id": "$.identityId"
            }
          }
        },
        {
          "name": "create_charlie",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "charlie"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "charlie_id": "$.identityId"
            }
          }
        },
        {
          "name": "create_diana",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "diana"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "diana_id": "$.identityId"
            }
          }
        },
        {
          "name": "alice_creates_network",
          "request": {
            "method": "POST",
            "path": "/networks",
            "body": {
              "name": "coffee-chat",
              "identityId": "${alice_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "network_id": "$.networkId",
              "default_channel_id": "$.defaultChannelId",
              "alice_user_id": "$.userId"
            }
          }
        },
        {
          "name": "alice_creates_invite",
          "request": {
            "method": "POST",
            "path": "/invites",
            "body": {
              "identityId": "${alice_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "invite_link": "$.inviteLink"
            }
          }
        },
        {
          "name": "bob_joins",
          "request": {
            "method": "POST",
            "path": "/users/join",
            "body": {
              "inviteLink": "${invite_link}",
              "identityId": "${bob_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "bob_user_id": "$.userId"
            }
          }
        },
        {
          "name": "charlie_joins",
          "request": {
            "method": "POST",
            "path": "/users/join",
            "body": {
              "inviteLink": "${invite_link}",
              "identityId": "${charlie_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "charlie_user_id": "$.userId"
            }
          }
        },
        {
          "name": "diana_joins",
          "request": {
            "method": "POST",
            "path": "/users/join",
            "body": {
              "inviteLink": "${invite_link}",
              "identityId": "${diana_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "diana_user_id": "$.userId"
            }
          }
        },
        {
          "name": "tick_after_joins",
          "request": {
            "method": "POST",
            "path": "/tick",
            "body": {}
          },
          "assertions": {
            "status": 200
          }
        },
        {
          "name": "verify_all_users_joined",
          "request": {
            "method": "GET",
            "path": "/users?network_id=${network_id}"
          },
          "assertions": {
            "status": 200,
            "body.users": {
              "$length": 4
            }
          }
        },
        {
          "name": "alice_sends_welcome",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${default_channel_id}",
              "user_id": "${alice_user_id}",
              "peer_id": "${alice_user_id}",
              "content": "Hey everyone! Welcome to our coffee chat network!"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "bob_responds",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${default_channel_id}",
              "user_id": "${bob_user_id}",
              "peer_id": "${bob_user_id}",
              "content": "Thanks for inviting us, Alice!"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "charlie_responds",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${default_channel_id}",
              "user_id": "${charlie_user_id}",
              "peer_id": "${charlie_user_id}",
              "content": "Happy to be here!"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "diana_responds",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${default_channel_id}",
              "user_id": "${diana_user_id}",
              "peer_id": "${diana_user_id}",
              "content": "This is great, thanks Alice!"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "tick_for_message_sync",
          "request": {
            "method": "POST",
            "path": "/tick",
            "body": {}
          },
          "assertions": {
            "status": 200
          }
        },
        {
          "name": "verify_all_messages",
          "request": {
            "method": "GET",
            "path": "/messages?channel_id=${default_channel_id}"
          },
          "assertions": {
            "status": 200,
            "body.messages": {
              "$length": 4
            }
          }
        }
      ]
    },
    
    "four_users_complex_channels": {
      "description": "Four users with multiple channels and groups",
      "steps": [
        {
          "name": "create_alice",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "alice"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "alice_id": "$.identityId"
            }
          }
        },
        {
          "name": "create_bob",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "bob"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "bob_id": "$.identityId"
            }
          }
        },
        {
          "name": "create_charlie",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "charlie"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "charlie_id": "$.identityId"
            }
          }
        },
        {
          "name": "create_diana",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "diana"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "diana_id": "$.identityId"
            }
          }
        },
        {
          "name": "alice_creates_tech_network",
          "request": {
            "method": "POST",
            "path": "/networks",
            "body": {
              "name": "tech-team",
              "identityId": "${alice_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "network_id": "$.networkId",
              "general_channel_id": "$.defaultChannelId",
              "alice_user_id": "$.userId"
            }
          }
        },
        {
          "name": "alice_creates_developers_group",
          "request": {
            "method": "POST",
            "path": "/groups",
            "body": {
              "name": "developers",
              "user_id": "${alice_user_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "dev_group_id": "$.groupId"
            }
          }
        },
        {
          "name": "alice_creates_designers_group",
          "request": {
            "method": "POST",
            "path": "/groups",
            "body": {
              "name": "designers",
              "user_id": "${alice_user_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "design_group_id": "$.groupId"
            }
          }
        },
        {
          "name": "alice_creates_dev_channel",
          "request": {
            "method": "POST",
            "path": "/channels",
            "body": {
              "name": "dev-chat",
              "network_id": "${network_id}",
              "user_id": "${alice_user_id}",
              "group_id": "${dev_group_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "dev_channel_id": "$.channelId"
            }
          }
        },
        {
          "name": "alice_creates_invite",
          "request": {
            "method": "POST",
            "path": "/invites",
            "body": {
              "identityId": "${alice_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "main_invite": "$.inviteLink"
            }
          }
        },
        {
          "name": "bob_joins_as_developer",
          "request": {
            "method": "POST",
            "path": "/users/join",
            "body": {
              "inviteLink": "${main_invite}",
              "identityId": "${bob_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "bob_user_id": "$.userId"
            }
          }
        },
        {
          "name": "charlie_joins_as_designer",
          "request": {
            "method": "POST",
            "path": "/users/join",
            "body": {
              "inviteLink": "${main_invite}",
              "identityId": "${charlie_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "charlie_user_id": "$.userId"
            }
          }
        },
        {
          "name": "diana_joins_as_both",
          "request": {
            "method": "POST",
            "path": "/users/join",
            "body": {
              "inviteLink": "${main_invite}",
              "identityId": "${diana_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "diana_user_id": "$.userId"
            }
          }
        },
        {
          "name": "tick_after_joins",
          "request": {
            "method": "POST",
            "path": "/tick",
            "body": {}
          },
          "assertions": {
            "status": 200
          }
        },
        {
          "name": "alice_adds_bob_to_dev_group",
          "request": {
            "method": "POST",
            "path": "/group-memberships",
            "body": {
              "user_id": "${bob_user_id}",
              "group_id": "${dev_group_id}",
              "added_by": "${alice_user_id}"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "alice_adds_charlie_to_design_group",
          "request": {
            "method": "POST",
            "path": "/group-memberships",
            "body": {
              "user_id": "${charlie_user_id}",
              "group_id": "${design_group_id}",
              "added_by": "${alice_user_id}"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "alice_adds_diana_to_dev_group",
          "request": {
            "method": "POST",
            "path": "/group-memberships",
            "body": {
              "user_id": "${diana_user_id}",
              "group_id": "${dev_group_id}",
              "added_by": "${alice_user_id}"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "alice_adds_diana_to_design_group",
          "request": {
            "method": "POST",
            "path": "/group-memberships",
            "body": {
              "user_id": "${diana_user_id}",
              "group_id": "${design_group_id}",
              "added_by": "${alice_user_id}"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "charlie_creates_design_channel",
          "request": {
            "method": "POST",
            "path": "/channels",
            "body": {
              "name": "design-chat",
              "network_id": "${network_id}",
              "user_id": "${charlie_user_id}",
              "group_id": "${design_group_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "design_channel_id": "$.channelId"
            }
          }
        },
        {
          "name": "tick_for_channel_creation",
          "request": {
            "method": "POST",
            "path": "/tick",
            "body": {}
          },
          "assertions": {
            "status": 200
          }
        },
        {
          "name": "alice_announces_in_general",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${general_channel_id}",
              "user_id": "${alice_user_id}",
              "peer_id": "${alice_user_id}",
              "content": "Welcome everyone to the tech team!"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "bob_introduces_in_general",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${general_channel_id}",
              "user_id": "${bob_user_id}",
              "peer_id": "${bob_user_id}",
              "content": "Great to be here! I'm Bob, backend developer"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "charlie_introduces_in_general",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${general_channel_id}",
              "user_id": "${charlie_user_id}",
              "peer_id": "${charlie_user_id}",
              "content": "Hi all! Charlie here, UX designer"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "diana_introduces_in_general",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${general_channel_id}",
              "user_id": "${diana_user_id}",
              "peer_id": "${diana_user_id}",
              "content": "Diana here - I do both frontend dev and design"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "alice_messages_in_dev_channel",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${dev_channel_id}",
              "user_id": "${alice_user_id}",
              "peer_id": "${alice_user_id}",
              "content": "@developers Let's discuss the new API structure"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "bob_responds_in_dev_channel",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${dev_channel_id}",
              "user_id": "${bob_user_id}",
              "peer_id": "${bob_user_id}",
              "content": "I'll post my thoughts in the backend-api channel"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "diana_responds_in_dev_channel",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${dev_channel_id}",
              "user_id": "${diana_user_id}",
              "peer_id": "${diana_user_id}",
              "content": "I can help with the frontend integration"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "tick_for_message_sync",
          "request": {
            "method": "POST",
            "path": "/tick",
            "body": {}
          },
          "assertions": {
            "status": 200
          }
        },
        {
          "name": "verify_general_messages",
          "request": {
            "method": "GET",
            "path": "/messages?channel_id=${general_channel_id}"
          },
          "assertions": {
            "status": 200,
            "body.messages": {
              "$length": 4
            }
          }
        },
        {
          "name": "verify_dev_channel_messages",
          "request": {
            "method": "GET",
            "path": "/messages?channel_id=${dev_channel_id}"
          },
          "assertions": {
            "status": 200,
            "body.messages": {
              "$length": 3
            }
          }
        },
        {
          "name": "verify_all_channels",
          "request": {
            "method": "GET",
            "path": "/channels?network_id=${network_id}"
          },
          "assertions": {
            "status": 200,
            "body.channels": {
              "$length": 3
            }
          }
        },
        {
          "name": "verify_all_groups",
          "request": {
            "method": "GET",
            "path": "/groups"
          },
          "assertions": {
            "status": 200,
            "body.groups": {
              "$length": 3
            }
          }
        }
      ]
    }
  }
}