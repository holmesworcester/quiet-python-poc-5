{
  "scenarios": {
    "check_group_memberships": {
      "description": "Verify group memberships are created correctly",
      "steps": [
        {
          "name": "create_alice",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "Alice"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "alice_id": "$.identityId"
            }
          }
        },
        {
          "name": "create_bob",
          "request": {
            "method": "POST",
            "path": "/identities",
            "body": {
              "name": "Bob"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "bob_id": "$.identityId"
            }
          }
        },
        {
          "name": "alice_creates_network",
          "request": {
            "method": "POST",
            "path": "/networks",
            "body": {
              "name": "Test Network",
              "identityId": "${alice_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "network_id": "$.networkId",
              "group_id": "$.firstGroupId",
              "channel_id": "$.defaultChannelId"
            }
          }
        },
        {
          "name": "create_invite",
          "request": {
            "method": "POST",
            "path": "/invites",
            "body": {
              "identityId": "${alice_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "invite_link": "$.inviteLink"
            }
          }
        },
        {
          "name": "bob_joins",
          "request": {
            "method": "POST",
            "path": "/users/join",
            "body": {
              "inviteLink": "${invite_link}",
              "identityId": "${bob_id}"
            }
          },
          "assertions": {
            "status": 201,
            "capture": {
              "bob_user_id": "$.userId"
            }
          }
        },
        {
          "name": "check_users",
          "request": {
            "method": "GET",
            "path": "/users?network_id=${network_id}"
          },
          "assertions": {
            "status": 200,
            "body.users": {
              "$length": 2
            },
            "body.users[0].group_id": "${group_id}",
            "body.users[1].group_id": "${group_id}",
            "capture": {
              "alice_user_id": "$.users[0].id"
            }
          }
        },
        {
          "name": "alice_sends_message",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${channel_id}",
              "user_id": "${alice_user_id}",
              "peer_id": "${alice_user_id}",
              "content": "Test from Alice"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "bob_sends_message",
          "request": {
            "method": "POST",
            "path": "/messages",
            "body": {
              "channel_id": "${channel_id}",
              "user_id": "${bob_user_id}",
              "peer_id": "${bob_user_id}",
              "content": "Test from Bob"
            }
          },
          "assertions": {
            "status": 201
          }
        },
        {
          "name": "check_messages",
          "request": {
            "method": "GET",
            "path": "/messages?channel_id=${channel_id}"
          },
          "assertions": {
            "status": 200
          }
        }
      ]
    }
  }
}